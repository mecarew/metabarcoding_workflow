---
title: "Corrections_to_ASV_library"
author: "MCarew"
date: "2024-09-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


This document contains scripts to correct errors in the document 'asv_library_97_aug24.xlsx'. A modified version will be produced from this script

# read in 'asv_library_97_aug24.xlsx' spreadsheets
```{r}
# read in flies
file_path <- "~/uomShare/wergStaff/MelCarew/git-data/asv_library_97_aug24.xlsx"

# Get the names of the sheets
sheet_names <- readxl::excel_sheets(file_path)

# Read the sheets into as dataframes
truncated_fills_df <- readxl::read_excel(file_path, sheet = sheet_names[1])  # contains full taxonomic information for classifications with truncated taxonomy
otu_groups_df <- readxl::read_excel(file_path, sheet = sheet_names[2], col_types = "text") # groups unclassified sequences into 'OTUs'
max_p_update_df <- readxl::read_excel(file_path, sheet = sheet_names[3])#updates/corrects any missing identifications or errors in classification
complexes_df <- readxl::read_excel(file_path, sheet = sheet_names[4])# identifies any ambiguous taxonomic assignments that should be considered as complexes
```

## Corrections/additions
The following scripts implement corrections and additions to the ASV library file following 

# general corrections to spelling of species names
```{r}
library(dplyr)

# Find and replace in the 'species' column
truncated_fills_df <- truncated_fills_df %>%
  mutate(species = gsub("Aedes alboannulotus", "Aedes alboannulatus", species),
         species = gsub("Hemianax papuensis", "Anax papuensis", species),
         species = gsub("Limnodrilus claparedeanus", "Limnodrilus claparedianus", species),
         species = gsub("Paracnephia orientalis", "Austrocnephia orientalis", species),
         species = gsub("Ulmerochorema stigma", "Ulmerochorema stigmum", species),
         species = gsub("Antiporus gilbertii", "Antiporus gilberti", species),
         species = gsub("Asmicridea edwardsi", "Asmicridea edwardsii", species),
         species = gsub("Austrolimnius waterhouseii", "Austrolimnius waterhousei", species),
         species = gsub("Culicoides bundyensi", "Culicoides bundyensis", species),
         species = gsub("Hyderodes shuckardi", "Hyderodes schuckardi", species),
         species = gsub("SImsonia longipes", "Simsonia longipes", species),
         species = gsub("Ferrissia sp. B-AAY1880 complex", "Ferrissia sp. B-ADR3550 group", species),
         species = gsub("Trinotoperla sp. complex B-ABX3905", "Trinotoperla sp. B-ABX3905 group", species),
         species = gsub("Notalina bifara complex B-ABV8023", "Notalina bifara  B-ABV8023 group", species),
         species = gsub("GB-", "G-", species),
         species = gsub("ZB-", "", species),
         species = gsub("complex", "group", species))

max_p_update_df <- max_p_update_df %>%
  mutate(species = gsub("Aedes alboannulotus", "Aedes alboannulatus", species),
         species = gsub("Hemianax papuensis", "Anax papuensis", species),
         species = gsub("Limnodrilus claparedeanus", "Limnodrilus claparedianus", species),
         species = gsub("Paracnephia orientalis", "Austrocnephia orientalis", species),
         species = gsub("Ulmerochorema stigma", "Ulmerochorema stigmum", species),
         species = gsub("Antiporus gilbertii", "Antiporus gilberti", species),
         species = gsub("Asmicridea edwardsi", "Asmicridea edwardsii", species),
         species = gsub("Austrolimnius waterhouseii", "Austrolimnius waterhousei", species),
         species = gsub("Culicoides bundyensi", "Culicoides bundyensis", species),
         species = gsub("Hyderodes shuckardi", "Hyderodes schuckardi", species),
         species = gsub("SImsonia longipes", "Simsonia longipes", species),
         species = gsub("Ferrissia sp. B-AAY1880 complex", "Ferrissia sp. B-ADR3550 group", species),
         species = gsub("Trinotoperla sp. complex B-ABX3905", "Trinotoperla sp. B-ABX3905 group", species),
         species = gsub("Notalina bifara complex B-ABV8023", "Notalina bifara  B-ABV8023 group", species),
         species = gsub("GB-", "G-", species),
         species = gsub("ZB-", "", species),
         species = gsub("complex", "group", species))

complexes_df <- complexes_df %>%
  mutate(complex = gsub("complex", "group", complex))

```
# corrections of records with incorrect species names
```{r}
asv_species_corrections <- c("70d22725893c8c5a6de91b0f5f7c1483" = "Atalophlebia sp. B-ABV8739",
"3f21ea3293d426980c0bb90cee947feb" = "Atalophlebia sp. B-ACM3545 group",
"e78f9bda3fc0623568541c2ead24a207" = "Atalophlebia sp. B-ACM3545 group",
"4e348190a398806a2a552afa1d9785bc" = "Atalophlebia sp. B-ACM3545 group",
"9f0c1c87cbbb54687329685716172501" = "Atalophlebia sp. B-ACM3545 group",
"dd3c0a3a15229d2473b6993ac29aa99a" = "Atalophlebia sp. B-ABV8738",
"1ee6186bfdb129f48c157ca1c0c9a4eb" = "Atalophlebia sp. B-ABV8738",
"b1a18f0dd7091e2518c1ff84ed5f84ba" = "Atalophlebia sp. B-ABV8738",
"65a3a3575d29e7c6148d5db6026e1e2b" = "Atalophlebia sp. B-ABV8738",
"381713edf4911d317655bbe78c03bd7c" = "Atalophlebia sp. B-ABV8738",
"4ed3e46ae94fed01456beece28d3462a" = "Atalophlebia sp. B-ABV8738",
"bff34b36461035f98b4a19c68585670d" = "Atalophlebia sp. B-ABV8738",
"95a45757ca0d1b368fe8074fd74c305e" = "Atalophlebia sp. B-ABV8738",
"6b5331b9ae4948258787c763a238337e" = "Atalophlebia sp. B-ABV8738",
"b942a5cbd781d243a76e2c4dd69d308a" = "Atalophlebia sp. B-ABV8738",
"a588b4d5cf19a86af46629e1079441ae" = "Atalophlebia sp. B-ABV8738",
"a401467f0889e90831b562a7a6b76754" = "Atalophlebia sp. B-ABV8738",
"f215cae2a2ad3fb1cb2022409008d7d7" = "Atalophlebia sp. B-ABV8738",
"cd110aeba62b0abe376f661f202833a9" = "Atalophlebia sp. B-ABV8738",
"d1fa9cf86fcf53138dbbb142b97f08b5" = "Atalophlebia sp. B-ABV8738",
"cb36ab35170b2da895e9b3d037f28e1e" = "Atalophlebia sp. B-ABV8738",
"e2a3cb032fd7259f3e5dfdd838e9ecde" = "Atalophlebia sp. B-ABV8738",
"a14e8463b305f03290cb4bcb08592f61" = "Atalophlebia sp. B-ABV8738",
"1322d61c1f535e021c096c299b528c06" = "Atalophlebia sp. B-ABV8738",
"21895efd7bd1d6feba3c2953cf88a5b3" = "Atalophlebia sp. B-ABV8738",
"9e677a3023f89ed21730330455690e16" = "Atalophlebia sp. B-ABV8738",
"5b188bdbc5b7941c7479a2a21981064e" = "Atalophlebia sp. B-ABV8738",
"a1431e9d360fafc2b2443de41c0c3782" = "Atalophlebia sp. B-ABV8738",
"5c88eefaaea3ed54fa3607b40c59cae6" = "Atalophlebia sp. B-ABV8738",
"2541e207f53779f1800ae3f512010c1f" = "Atalophlebia sp. B-ABV8738",
"bba8aa05127e1611e543e2460f164ec5" = "Atalophlebia sp. B-ABV8738",
"203b1c5cab85ecf7d52c3e0bcb8b0796" = "Atalophlebia sp. B-ABV8738",
"565684b97d85973575fe6141646bb8a4" = "Atalophlebia sp. B-ABV8738",
"d09293a1eac202f29b0e7129cfeeacd9" = "Atalophlebia sp. B-ABV8738",
"890a8b167337ad43aea29ff52abce49a" = "Atalophlebia sp. B-ABV8738",
"a97cbbfeab2012203000003a1adb0cc0" = "Atalophlebia sp. B-ABV8738",
"b42084ae609f8be35664d7da75a033d5" = "Atalophlebia sp. B-ABV8738",
"ba38db874b621f4b4b153f2029227c1e" = "Atalophlebia sp. B-ABV8738",
"959bccfd4539922de2d81c1ac8bffc60" = "Atalophlebia sp. B-ABV8738",
"41bb20f079819ba1bc999cff4264ce10" = "Atalophlebia sp. B-ABV8738",
"a45b2f42201c473c0bda9448991f2f76" = "Austrheithrus glymma group",
"9fa8ccb4ebacd70196bec0fe4009dbdb" = "Austrosimulium furiosum",
"3cc32551412c73ec2b0c7966d5ae0566" = "Buchholzia sp. B-AAT8933",
"64d1a48a6ecdf91a3302ac93abb2660b" = "Cardiocladius sp. B-AAW4309",
"f2a4e6257cf87a30b64a0b2bae77383c" = "Chaetogaster diastrophus",
"86b33bf13e66c6c67d3f5474293b571e" = "Cheumatopsyche alampeta",
"238c2c0ba0114584f6c19f0af402918d" = "Cheumatopsyche alampeta",
"41731cb0901269ad2a332136172821e9" = "Cheumatopsyche alampeta",
"a61411743ca3648acb6ba5515a790bac" = "Cheumatopsyche alampeta",
"d69784b654683ffbf8c9f4b322fcceac" = "Coloburiscoides munionga",
"6fd09aa00745f711988abb7f706f94d3" = "Cricotopus sp. B-ACQ6787",
"70dd479dab11e6c210f1b09ee0e034ef" = "Cricotopus tasmania",
"a63f49201a1d50046d9d30dfb66dc8ad" = "Cricotopus tasmania",
"7a2c1044d52c83b368a156311ecebd8c" = "Dinotoperla thwaitesi",
"73ea249cf444d566b8f16ac379050060" = "Dinotoperla thwaitesi",
"939a96cb02f7b39f695000ed1cceb03e" = "Dinotoperla thwaitesi",
"861e0cfb5221abdc6064db2b1926fce8" = "Dinotoperla walkeri/evansi",
"b167c9e6e63d586c8f79138f640da0cb" = "Eusthenia sp. B-ABX4126",
"da4d55f930d324ef809f8cb8ed9f7f92" = "Limnophyes sp. B-ABV0255",
"a787c9445c65f9dd4c79bc70d36a6b43" = "Notriolus sp. B-ACG2297",
"40c9a0e410636ea12e8939097e2d1e70" = "Illiesoperla mayi",
"c1921daa3f5540925d9e5665ddd685d7" = "Illiesoperla mayi",
"7c5030e27cdd452bca4b9f8e0053282c" = "Ferrissia sp. B-AAE6642",
"550b713ce1a34a038a8397950a2c1e88" = "Ferrissia sp. B-AAE6642",
"9c8d4ed11f998adb5b1d39c37ab5757a" = "Ferrissia sp. B-AAE6642",
"d7ec6a3ffce28d814e99a0fb4bc341fc" = "Orthotrichia sp. B-ACN2323",
"3c53818b7dba9d904b7eea8ff74da37f" = "Orthotrichia sp. B-ACN2323",
"f7358734f527c2ee2d34faee20d698c9" = "Orthotrichia sp. B-ACN2323",
"82d28b72c3abb370e13d65dd276f89ee" = "Rhadinosticta simplex",
"65f7c2bfe69db19644a64586b0d58634" = "Rhadinosticta simplex",
"caef4a0caa706750af87af8b29f76cca" = "Rhadinosticta simplex",
"f69cda376ebfda153f279dd5a4ec0620" = "Rhadinosticta simplex",
"2ea0943ed6a0c0226ca86b14bdba3a86" = "Koorrnonga sp. B-ABV9141",
"2663fc79f8b9ef35a7034bbab1d17c84" = "Koorrnonga sp. B-ABV9141",
"417a147572314eb831920593a6f855a6" = "Limnodrilus hoffmeisteri",
"73b30f3d5ed35a60478bb40faa743103" = "Limnophila sp. B-ABX1092",
"54c4f55ce6c085a4ae3c48b0f6cfdf85" = "Limnophila sp. B-ABX1092",
"5891552594c69be0ce0115907b14e679" = "Limnophila sp. B-ABX1092",
"ca0d841497e5adc77bb5c77ad6387a55" = "Limnophila sp. B-ABX1092",
"f9f17f1fc2377cf4a3ad3af2e06b8822" = "Limnophila sp. B-ABX1092",
"c5e9ed11cb3e54ebe7be96ab7fa4e7bb" = "Limnophila sp. B-ABX1092",
"3ba6698641d2024757af7d454cf2f7b2" = "Limnophila sp. B-ABX1092",
"69f0912a9f5891036280cd9ba3e42b2f" = "Limnophila sp. B-ABX1092",
"f02ae936d610e8de0863bc9c5b4f7775" = "Limnophila sp. B-ABX1092",
"a754f5c95f942ea3e163edc51f4c5340" = "Limnophila sp. B-ABX1092",
"717f60174e763821a83f2a0e2ab4cbfe" = "Limnophila sp. B-ABX1092",
"022d6c5f8ca3ddbb38862fca738ac945" = "Limnophila sp. B-ABX1092",
"d361f81aada6a3131743d917a65ce5e0" = "Limnophila sp. B-ABX1092",
"4b2149125b1eab4d0bf0aa4b3a3f3e33" = "Limnophila sp. B-ABX1092",
"1bb889d6c302970481be889e8a5f072b" = "Limnophila sp. B-ABX1092",
"e4452ccd492478fde868f344768d8805" = "Limnophila sp. B-ABX1092",
"3dbfba4ead1a39db6b9a8dca521fe0cd" = "Limnophila sp. B-ABX1092",
"9e43bbc1aa041afebb1729d917e2982b" = "Limnophila sp. B-ABA7043",
"93f462dbf201410a4c974864acaa9fb0" = "Lingora sp. B-ABY8640/AAX5053",
"6f7613ecf48108b0bca63214e95ddcca" = "Lingora sp. B-ABY8640/AAX5053",
"fa0de3c722446253f03b74865de00718" = "Notalina sp. B-AAX5636",
"a67b61dbe9026c95e7c3c25850c6c5b9" = "Polypedilum sp. B-ABW9978 complex",
"d48af1b82d2eb69c5d0da945d3366ae3" = "Polypedilum sp. B-ABW9978 complex",
"59372b4f54b83af133acd252413da311" = "Polypedilum sp. B-ABW9978 complex",
"d519a38d28845ececf8021aea89531b8" = "Polypedilum sp. B-ABW9978 complex",
"291cc67efd2da86187773af96c3e3f56" = "Polypedilum sp. B-ABW9978 complex",
"511189152aa7f9d85677418faf42d06e" = "Procorticacarus victorianus",
"52a8e64777b6f4c814c66bb5079989bb" = "Psychodidae sp. B-ABX5328",
"974cf8d785ec14d520a28a8818ebc7b4" = "Psychodidae sp. B-ABX5328",
"c2d4cf0d470ec12e35414a11ef0e9109" = "Psychodidae sp. B-ABX5328",
"405998b987b936242e29741e7f0660bc" = "Psychodidae sp. B-ABA8299",
"73027f700d0ee65d3a298efbb1f1a32f" = "Psychodidae sp. B-ABA8299",
"88d6f6daac318409374d918f40df3ffb" = "Ptychobiosis sp. B-AAZ4433",
"8bdc2627bd8205a94f40a831d20e1aef" = "Riethia sp. B-ADU5431",
"1d5760deee25f457d5f3aae91017277a" = "Riethia sp. B-ADU5431",
"ea684a894cc14c0925e5d020a9d7688c" = "Scatella sp. B-ACK6288/ACZ6583",
"7c37484ef50b5a349f73a716e89e42c5" = "Trinotoperla sp. B-ABX3937",
"ddcda4ff5e9b8671ad3fc3a0e9e16528" = "Trinotoperla sp. B-ABX3937",
"a3fe86602ff20f2b783583479eb170c4" = "Trinotoperla sp. B-ABX3937",
"220c6618187900450d1dcbb0f4d4d50d" = "Trinotoperla sp. B-ABX3937",
"be8e76eeb23d917e56f02dee0843b7cc" = "Trinotoperla sp. B-ABX3937",
"40fcd2e8af6ea029fdadeca338dc5c9b" = "Trinotoperla sp. B-ABX3937",
"c9b5c5cd88d41c2d881b924ccf47ea4d" = "Ulmerochorema onychion",
"b219d1dce6730bb64da1e45908ee8e3d" = "Ulmerophlebia sp. B-ABV8830",
"eb8a6ac51ba6e4ec934d77dfe7093571" = "Psychoda gemina",
"f2580e04289f1d317c72f6db321bdd9f" = "Psychoda gemina",
"9b4fd984d9ce6d3a02d16b014004f6e6" = "Psychoda gemina",
"c26d3a09def236ddd150bacc51117c55" = "Psychoda gemina",
"7e51985e8eedc43b9477c0f8697ee18a" = "Psychoda gemina",
"283e9e16054ee601d749f2f959958e1f" = "Psychoda gemina",
"af2ad7276ba40e03989a485856d1b0b8" = "Psychoda gemina",
"c85fa78fa52e9d30ea72015607998944" = "Psychoda gemina",
"91718ad5f4ac2909fc4dabf3b7f83058" = "Psychoda gemina",
"3b9fa04c8f620038fb9bace9f1512db2" = "Psychoda gemina",
"71b7133a1e35444c1387ebce1efb9c28" = "Psychoda gemina",
"15ad79e5f9cf6f49b71709fe727cf470" = "Psychoda gemina",
"a88b8fa7362a69b12d30503dc0e0d40a" = "Psychoda gemina",
"81987c57de8c8f22484fc7fec4968faa" = "Psychoda gemina",
"4a1f3d084687a5aa80f0cd00756dfbdf" = "Ceratopogonidae sp. B-ADC4845",
"c39071b45b2b525d469880c964415d69" = " Atalophlebia sp. B-ABV8738",
"41ce939b84d4c7112897272755142a23" = "Coenoria sp. B-ABX6841",
"c943023dbfdf852f96b76e2dcbd5f50d" = "Triplectides sp. B-AAE7976",
"d2ef9058a103a1979e980e612264520e" = "Triplectides sp. B-AAE7976",
"f5d5087598c770d95edc3439abc7289e" = "Triplectides sp. B-AAE7976",
"17c2cab3817d9ea79ce1a0227e16aebf" = "Triplectides sp. B-AAE7976",
"6a34b14ed40b13400ef226f0be01fba0" = "Triplectides sp. B-AAE7976",
"6c80faf3a4ffaa4cf3c671b53794d054" = "Triplectides sp. B-AAE7976",
"4b7764a805eac8286cc0458955f7071a" = "Triplectides sp. B-AAE7976",
"08227125d404fb7c99e777cd0feb6e19" = "Triplectides sp. B-AAE7976",
"beb2be3786f39b4e2b86e345bce96b9b" = "Nothocyphon serratipenis",
"7991ada89d1e5bc6d86e0b79ebb273c9" = "Nothocyphon serratipenis",
"a9ca6b9e0d6c2c3f69a1ab6f62227e6c" = "Nothocyphon serratipenis",
"201cfdafcc628ccbcbd13f77928a97af" = "Nothocyphon serratipenis",
"516cca6e694eef5726c0dbbb76dc5414" = "Nothocyphon serratipenis",
"ba5fb41916aff499ffee8e4bb86578f0" = "Nothocyphon serratipenis",
"3e55ecc587652697ef5db92aa60564cf" = "Nothocyphon serratipenis",
"415f18a3295dc264a9f199cc78e101ad" = "Nothocyphon serratipenis",
"767925f33c3613abdb2c5df758cb5633" = "Culicoides sigmoidus",
"75f3fbd1e44caedd30cafdc7619b1668" = "Culicoides sigmoidus",
"89002fcf8b68c4719b9b74f183b4127e" = "Culicoides sigmoidus",
"77145e511d943073d06091b644f724b8" = "Culicoides sigmoidus",
"25370f418fc2d7a5220655ff24fbbd6e" = "Nousia sp. B-ACM3519",
"6abec724e4ec8d2683da63476a6e59d7" = "Cosmioperla sp. B-AEC8235",
"51bb3b643e6c884ac72e340348a32c33" = "Ablabesmyia sp. B-AAP5135 complex",
"d67b66092a6572d57ac7290d21ef39c4" = "Coloburiscoides munionga",
"314b908770c6f9c296aaab2da5698807" = "",
"81530c1415a28a9a62322a482d714cef" = "",
"3dc52e2c7a31e2a01a84549b92911bcb" = "",
"f0e1b9af3b6dbb9a5afc88807a33f535" = "",
"aa465397725596f1c084e4e48197372d" = "",
"155515de679ea3f96eb251597a8355f5" = "",
"7e9db264fabad9a9b2ac755cc524baa3" = "",
"66c7e7bc806cfca10de70609b1ae1117" = "",
"7abdbe52662941a5b1d6956f74fc8ccf" = "",
"fb92efc10fba6e13b30c4e20f3f4be70" = "",
"d971c3c25d994549e1ab94b17048486a" = "",
"2a8674533aa6463808dced5102f0a1e5" = "",
"384f60818615b4dc43d21b4fde820d21" = "",
"2a09b204ea25d3ee0c23b26d00822dcf" = "",
"c3ef326630a4b7eee124b7f4aa844cd6" = "",
"3ea037839cc56c6adab4409ca544f57a" = "",
"5fa5b580d9fb1c0503c5b4d05ce567e0" = "",
"f2700c9ffaef418a7a9823b08b2b83c9" = "",
"6a9ea49438ba346534d213bc5fa3412e" = "",
"693405ffa22eb11c8a4302db0e8b6b7e" = "",
"edc9cb8e69fe75af9826b60ecbc8f39b" = "",
"a06bcf800ab074457f826c9026d93a05" = "",
"60b0c55b3de6bcf0a4a4d4f2485a7ff7" = "",
"c648f0859a67b40edf948409b8a4967a" = "",
"bb9f84db19013052915d3b1ac559f11f" = "",
"c3a2b4cfa3238dd8f6e5bf800290fd05" = "",
"c56010a8847101c6f955be8758ba6963" = "",
"f4c35e10c8e86a6dcee244a349473149" = "",
"0bcf51bb494deb438b90e3e956a645bb" = "",
"5ec678fc07a30a88297abe1aa71a4ead" = "",
"d32a5e240858359c1bd7d6ebde67fe5b" = "",
"d453f558117b6d43a6d2feafbd877e0e" = "",
"17edbbd11bdd22030c71999c0ed07036" = "",
"2aadb65453c6df2420448394917cbc2f" = "",
"94dda310e20d3e23a2752787a41a30f3" = "",
"cb50aead3ff372183a06f8d09c03ef86" = "",
"48b5d8e5472a2cf15d8acf17bfe90ccc" = "",
"aad7ed86c3f30cfe5ee5bf4b8226d159" = "",
"8ef04e58e9a04a7345c1310b8cc48b58" = "",
"e64a94ea4d2c5000abac84231068b15b" = "",
"65b850c96c49333ef25d783db98a5f9d" = "",
"20c0f2c414bc8b2ff71a32ef4a6da942" = "",
"4ff6a29cd87280c79d609ba2690b9b92" = "",
"50a1d897e621e2dbb170bc4a7d206319" = "",
"91162e539c973809dfa49f065bcb46c2" = "",
"9e5035bf7ec6a1f2c651ed0e98ed2da7" = "")

# Update the species column based on asv_code matching the correction vector
truncated_fills_df <- truncated_fills_df %>%
  mutate(species = ifelse(asv_code %in% names(asv_species_corrections),
                          asv_species_corrections[asv_code],
                          species))

```

# corrections of records with incorrect genus names
```{r}
asv_genus_corrections <- c("64d1a48a6ecdf91a3302ac93abb2660b" = "Cardiocladius",
"b167c9e6e63d586c8f79138f640da0cb" = "Eusthenia",
"40c9a0e410636ea12e8939097e2d1e70" = "Illiesoperla",
"c1921daa3f5540925d9e5665ddd685d7" = "Illiesoperla",
"417a147572314eb831920593a6f855a6" = "Limnodrilus",
"73b30f3d5ed35a60478bb40faa743103" = "Limnophila",
"54c4f55ce6c085a4ae3c48b0f6cfdf85" = "Limnophila",
"5891552594c69be0ce0115907b14e679" = "Limnophila",
"ca0d841497e5adc77bb5c77ad6387a55" = "Limnophila",
"f9f17f1fc2377cf4a3ad3af2e06b8822" = "Limnophila",
"c5e9ed11cb3e54ebe7be96ab7fa4e7bb" = "Limnophila",
"3ba6698641d2024757af7d454cf2f7b2" = "Limnophila",
"69f0912a9f5891036280cd9ba3e42b2f" = "Limnophila",
"f02ae936d610e8de0863bc9c5b4f7775" = "Limnophila",
"a754f5c95f942ea3e163edc51f4c5340" = "Limnophila",
"717f60174e763821a83f2a0e2ab4cbfe" = "Limnophila",
"022d6c5f8ca3ddbb38862fca738ac945" = "Limnophila",
"d361f81aada6a3131743d917a65ce5e0" = "Limnophila",
"4b2149125b1eab4d0bf0aa4b3a3f3e33" = "Limnophila",
"1bb889d6c302970481be889e8a5f072b" = "Limnophila",
"e4452ccd492478fde868f344768d8805" = "Limnophila",
"3dbfba4ead1a39db6b9a8dca521fe0cd" = "Limnophila",
"d7ec6a3ffce28d814e99a0fb4bc341fc" = "Orthotrichia",
"3c53818b7dba9d904b7eea8ff74da37f" = "Orthotrichia",
"f7358734f527c2ee2d34faee20d698c9" = "Orthotrichia",
"82d28b72c3abb370e13d65dd276f89ee" = "Rhadinosticta",
"65f7c2bfe69db19644a64586b0d58634" = "Rhadinosticta",
"caef4a0caa706750af87af8b29f76cca" = "Rhadinosticta",
"f69cda376ebfda153f279dd5a4ec0620" = "Rhadinosticta",
"9ca9760013a77462d9c5e2c942e4d27e" = "Phytophthora",
"d5ee6716a28d4eb9b0d60465ff707327" = "Atrichopogon",
"bef6b5cae9985af4b85a6b605fa9fdde" = "Atrichopogon",
"1acd38a074a29e8ec63a20a7417366c0" = "Atrichopogon",
"2746221e52f4eaf9941524f1e91d1938" = "Atrichopogon",
"1510e9da49de6fd35eeb269c7e009bdc" = "Atrichopogon",
"3884d87677ac17de269a9dcb9f4e122e" = "Atrichopogon",
"b673ad9c60ae7b8ca484dca510c480b7" = "Atrichopogon",
"89826614d379a646660009c87d7277a4" = "Atrichopogon",
"966d602e3b481bdce8fcb84d7e12e284" = "Atrichopogon",
"beb2be3786f39b4e2b86e345bce96b9b" = "Nothocyphon",
"7991ada89d1e5bc6d86e0b79ebb273c9" = "Nothocyphon",
"a9ca6b9e0d6c2c3f69a1ab6f62227e6c" = "Nothocyphon",
"201cfdafcc628ccbcbd13f77928a97af" = "Nothocyphon",
"516cca6e694eef5726c0dbbb76dc5414" = "Nothocyphon",
"ba5fb41916aff499ffee8e4bb86578f0" = "Nothocyphon",
"3e55ecc587652697ef5db92aa60564cf" = "Nothocyphon",
"415f18a3295dc264a9f199cc78e101ad" = "Nothocyphon",
"4ff6a29cd87280c79d609ba2690b9b92" = "",
"91162e539c973809dfa49f065bcb46c2" = "")

# Update the species column based on asv_code matching the correction vector
truncated_fills_df <- truncated_fills_df %>%
  mutate(genus = ifelse(asv_code %in% names(asv_genus_corrections),
                          asv_genus_corrections[asv_code],
                          genus))

```

# corrections of records with incorrect family names
```{r}
asv_family_corrections <- c("b167c9e6e63d586c8f79138f640da0cb" = "Eustheniidae",
"9ca9760013a77462d9c5e2c942e4d27e" = "Peronosporaceae")

# Update the species column based on asv_code matching the correction vector
truncated_fills_df <- truncated_fills_df %>%
  mutate(family = ifelse(asv_code %in% names(asv_family_corrections),
                          asv_family_corrections[asv_code],
                          family))

```


# corrections of records with incorrect order names
```{r}
asv_order_corrections <- c("9ca9760013a77462d9c5e2c942e4d27e" = "Peronosporales")

# Update the species column based on asv_code matching the correction vector
truncated_fills_df <- truncated_fills_df %>%
  mutate(order = ifelse(asv_code %in% names(asv_order_corrections),
                          asv_order_corrections[asv_code],
                         order))
```

# corrections of records with incorrect class names
```{r}
asv_class_corrections <- c("9ca9760013a77462d9c5e2c942e4d27e" = "Oomycota")

# Update the species column based on asv_code matching the correction vector
truncated_fills_df <- truncated_fills_df %>%
  mutate(class = ifelse(asv_code %in% names(asv_class_corrections),
                          asv_class_corrections[asv_code],
                         class))
```

# corrections of records with incorrect phylum names
```{r}
asv_phylum_corrections <- c("9ca9760013a77462d9c5e2c942e4d27e" = "Heterokontophyta")

# Update the species column based on asv_code matching the correction vector
truncated_fills_df <- truncated_fills_df %>%
  mutate(phylum = ifelse(asv_code %in% names(asv_phylum_corrections),
                          asv_phylum_corrections[asv_code],
                         phylum))
```

```{r}
max_p_identity_corrections <- c("9e5035bf7ec6a1f2c651ed0e98ed2da7" = "96.6",
"d453f558117b6d43a6d2feafbd877e0e" = "96.4",
"5ec678fc07a30a88297abe1aa71a4ead" = "96.5",
"d32a5e240858359c1bd7d6ebde67fe5b" = "96.5",
"314b908770c6f9c296aaab2da5698807" = "96.7",
"81530c1415a28a9a62322a482d714cef" = "94.6",
"3dc52e2c7a31e2a01a84549b92911bcb" = "95",
"f0e1b9af3b6dbb9a5afc88807a33f535" = "95",
"aa465397725596f1c084e4e48197372d" = "96",
"155515de679ea3f96eb251597a8355f5" = "96",
"7e9db264fabad9a9b2ac755cc524baa3" = "96.7",
"66c7e7bc806cfca10de70609b1ae1117" = "96.5",
"7abdbe52662941a5b1d6956f74fc8ccf" = "96.7",
"fb92efc10fba6e13b30c4e20f3f4be70" = "96.7",
"d971c3c25d994549e1ab94b17048486a" = "96.4",
"2a8674533aa6463808dced5102f0a1e5" = "96.5",
"384f60818615b4dc43d21b4fde820d21" = "96.4",
"2a09b204ea25d3ee0c23b26d00822dcf" = "96.4",
"c3ef326630a4b7eee124b7f4aa844cd6" = "96.4",
"3ea037839cc56c6adab4409ca544f57a" = "96",
"5fa5b580d9fb1c0503c5b4d05ce567e0" = "96.4",
"f2700c9ffaef418a7a9823b08b2b83c9" = "96.8",
"6a9ea49438ba346534d213bc5fa3412e" = "96.8",
"693405ffa22eb11c8a4302db0e8b6b7e" = "96.8",
"edc9cb8e69fe75af9826b60ecbc8f39b" = "96.8",
"a06bcf800ab074457f826c9026d93a05" = "96.8",
"60b0c55b3de6bcf0a4a4d4f2485a7ff7" = "90",
"c648f0859a67b40edf948409b8a4967a" = "90",
"bb9f84db19013052915d3b1ac559f11f" = "90",
"c3a2b4cfa3238dd8f6e5bf800290fd05" = "93",
"c56010a8847101c6f955be8758ba6963" = "95",
"f4c35e10c8e86a6dcee244a349473149" = "95",
"0bcf51bb494deb438b90e3e956a645bb" = "95",
"17edbbd11bdd22030c71999c0ed07036" = "95",
"2aadb65453c6df2420448394917cbc2f" = "95",
"94dda310e20d3e23a2752787a41a30f3" = "96",
"cb50aead3ff372183a06f8d09c03ef86" = "96.7",
"48b5d8e5472a2cf15d8acf17bfe90ccc" = "96.5",
"aad7ed86c3f30cfe5ee5bf4b8226d159" = "96.7",
"8ef04e58e9a04a7345c1310b8cc48b58" = "96",
"e64a94ea4d2c5000abac84231068b15b" = "96.5",
"65b850c96c49333ef25d783db98a5f9d" = "96",
"20c0f2c414bc8b2ff71a32ef4a6da942" = "96",
"4ff6a29cd87280c79d609ba2690b9b92" = "92",
"50a1d897e621e2dbb170bc4a7d206319" = "96",
"91162e539c973809dfa49f065bcb46c2" = "92")

# Identify the rows to update
updated_rows <- truncated_fills_df %>%
  filter(asv_code %in% names(max_p_identity_corrections))

# Update the max_p_identity column in truncated_fills_df based on asv_code matching the correction vector
truncated_fills_df <- truncated_fills_df %>%
  mutate(max_p_identity = ifelse(asv_code %in% names(max_p_identity_corrections),
                                 max_p_identity_corrections[asv_code],
                                 max_p_identity))

# Add the updated rows to max_p_update_df (these records need to be moved to the max_p_update_df so the max_p_identity will be updates) 

max_p_update_df <- rbind(max_p_update_df, updated_rows)

# Remove only the updated rows from truncated_fills_df
truncated_fills_df <- truncated_fills_df %>%
  filter(!asv_code %in% names(max_p_identity_corrections))
```

# delete misidentified records
```{r}
truncated_fills_df <- truncated_fills_df %>%
  filter(!asv_code %in% c("9725daabf323ef5cf9b512ee0b06f682", 
                          "160985800d21d905b2e3dff1edc1bf18", 
                          "238f54c32343060e69613167f345dd15"))
```

# add new complexes (groups) to complexes_df
```{r}
bin_name <-  c("Asmicridea edwardsii",
"Asmicridea sp. B-AAD2412",
"Asmicridea sp. B-ABV8740",
"Atrichopogon sp. B-ABX7319",
"Ceratopogonidae sp. B-ABX0996",
"Austrheithrus glymma",
"Austrheithrus sp. B-AAW2994",
"Austrheithrus sp. B-ABZ7475",
"Austropyrgus centralia",
"Austropyrgus turbatus",
"Austropyrgus sp. B-AAW3122",
"Chironomidae sp. B-ACG8753",
"Polypedilum sp. MC-FS1",
"Chironomidae sp. B-ABA7844",
"Chironomidae sp. B-ABA7848",
"Coenoria sp. B-AAX3064",
"Coenoria sp. B-ABX6841",
"Coenoria sp. B-ABX6842",
"Dinotoperla thwaitesi",
"Dinotoperla sp. B-ADK4863",
"Dinotoperla sp. B-ADJ9199",
"Dinotoperla sp. B-ADK6597",
"Dinotoperla sp. B-ADK4862",
"Dinotoperla sp. B-ADK4864",
"Dinotoperla sp. B-ABX4167",
"Dinotoperla sp. B-ADK4861",
"Dinotoperla sp. B-ABX4126",
"Diptera sp. B-AEV0976",
"Simuliidae sp. B-AEV0976",
"Simuliidae sp. B-AEV6641",
"Gynoplistia bimaculata",
"Gynoplistia lowanna",
"Gynoplistia sp. B-ACM3369",
"Gynoplistia sp. B-ABW4478",
"Hydra oligactis",
"Hydra sp. B-AAX2383",
"Hydra robusta",
"Hydra sp. B-AAX2396",
"Hydra sinensis",
"Hydra viridissima",
"Nousia sp. B-AAV4106",
"Nousia sp. B-ACM3519",
"Nousia sp. B-AAV4106",
"Nousia sp. B-ACM3519",
"Polypedilum sp. B-ACQ1905",
"Polypedilum sp. B-ACS6047",
"Polypedilum sp. B-ACQ1906",
"Polypedilum sp. B-ACS3491",
"Polypedilum sp. B-ACS6048",
"Polypedilum sp. B-ACS6045",
"Tamasia acuta",
"Tamasia variegata",
"Tamasia sp. B-ACF0164",
"Tamasia sp. B-AAK0518",
"Laevapex nipponica",
"Ferrissia fragilis",
"Ferrissia californica",
"Zavrelimyia sp. B-AEN0522",
"Zavrelimyia sp. B-AEN0524",
"Zavrelimyia sp. B-AEN7359",
"Scatella sp. B-ACZ6583",
"Scatella sp. B-ACK6288",
"Scatella stagnalis",
"Scatella tenuicosta",
"Scatella lutosa",
"Scatella subvittata",
"Sclerocyphon sp. C-18",
"Sclerocyphon sp. C-19",
"Sclerocyphon sp. C-20",
"Sclerocyphon sp. C-21",
"Pisidium sp. cf. hallae",
"Austropyrgus centralia",
"Hydra vulgaris",
"Apsectrotanypus sp. B-AEM8177",
"Apsectrotanypus sp. B-AEM8936",
"Kiefferulus intertinctus",
"Tasmanophlebia sp. B-ACM3395",
"Tasmanophlebia sp. B-AAV8388",
"Nannochorista dipteroides",
"Dinotoperla serricauda",
"Leptoperla kimminsi",
"Apsilochorema obliquum",
"Triplectides truncatus",
"Paratya australiensis")

complex <- c("Asmicridea edwardsii group",
"Asmicridea edwardsii group",
"Asmicridea edwardsii group",
"Atrichopogon sp. B-ABX7319/ABX0996",
"Atrichopogon sp. B-ABX7319/ABX0996",
"Austrheithrus glymma group",
"Austrheithrus glymma group",
"Austrheithrus glymma group",
"Austropyrgus centralia/turbatus",
"Austropyrgus centralia/turbatus",
"Austropyrgus centralia/turbatus",
"Polypedilum sp. B-ACG8753",
"Polypedilum sp. B-ACG8753",
"Chironomidae sp. B-ABA7844/ABA7848",
"Chironomidae sp. B-ABA7844/ABA7848",
"Coenoria sp. B-ABX6841 group",
"Coenoria sp. B-ABX6841 group",
"Coenoria sp. B-ABX6841 group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Dinotoperla thwaitesi group",
"Simuliidae sp. B-AEV0976/AEV6641",
"Simuliidae sp. B-AEV0976/AEV6641",
"Simuliidae sp. B-AEV0976/AEV6641",
"Gynoplistia bimaculata/lowanna",
"Gynoplistia bimaculata/lowanna",
"Gynoplistia bimaculata/lowanna",
"Gynoplistia bimaculata/lowanna",
"Hydra oligactis/robusta",
"Hydra oligactis/robusta",
"Hydra oligactis/robusta",
"Hydra sinensis/viridissima",
"Hydra sinensis/viridissima",
"Hydra sinensis/viridissima",
"Nousia sp. B-AAV4106 group",
"Nousia sp. B-AAV4106 group",
"Nousia sp. B-AAV4106 group",
"Nousia sp. B-AAV4106 group",
"Polypedilum sp. B-ABW9978 complex",
"Polypedilum sp. B-ABW9978 complex",
"Polypedilum sp. B-ABW9978 complex",
"Polypedilum sp. B-ABW9978 complex",
"Polypedilum sp. B-ABW9978 complex",
"Polypedilum sp. B-ABW9978 complex",
"Tamasia acuta/variegata",
"Tamasia acuta/variegata",
"Tamasia acuta/variegata",
"Tamasia acuta/variegata",
"Ferrissia sp. B-ADR3550 group",
"Ferrissia sp. B-ADR3550 group",
"Ferrissia sp. B-ADR3550 group",
"Zavrelimyia sp. B-AEN0522/AEN0524",
"Zavrelimyia sp. B-AEN0522/AEN0524",
"Zavrelimyia sp. B-ACQ7611 complex",
"Scatella sp. B-ACK6288/ACZ6583",
"Scatella sp. B-ACK6288/ACZ6583",
"Scatella sp. B-ACK6288/ACZ6583",
"Scatella sp. B-ACK6288/ACZ6583",
"Scatella sp. B-ACK6288/ACZ6583",
"Scatella sp. B-ACK6288/ACZ6583",
"Sclerocyphon sp. C-18 group",
"Sclerocyphon sp. C-18 group",
"Sclerocyphon sp. C-18 group",
"Sclerocyphon sp. C-18 group",
"Pisidium sp. cf. hallae group",
"Austropyrgus centralia group",
"Hydra vulgaris",
"Apsectrotanypus sp. B-AEM8177/AEM8936",
"Apsectrotanypus sp. B-AEM8177/AEM8936",
"Kiefferulus intertinctus group",
"Tasmanophlebia sp. B-ACM3395/AAV8388",
"Tasmanophlebia sp. B-ACM3395/AAV8388",
"Nannochorista dipteroides group",
"Dinotoperla serricauda group",
"Leptoperla kimminsi group",
"Apsilochorema obliquum group",
"Triplectides truncatus group",
"Paratya australiensis group")

# Combine into a data frame
new_complexes <- data.frame(bin_name = bin_name, complex = complex, stringsAsFactors = FALSE)

# Add to existing complexes dataframe
complexes_df <- rbind(complexes_df, new_complexes)
```

There are a small number of asv records that show overlap of less that 98% but greater than 97% overlap with existing BIN. In all but the exceptions below these asv's separate into discrete groups (without overlappling BINs). These asv include
species/asv(s)

Atalophlebia sp. B-ACM3545  70d22725893c8c5a6de91b0f5f7c1483

Cryptochironomus sp. B-ACS4478/ACS3865 f066a63f4be7f1afa34e27c7e3714d0c

Lingora sp. B-ACC8619 735492437a56a4f6abdbf33ed55b592c, d3144ff41766d86574ccac06c5403646, 942f26219b03e8fb78ec4192f366785a

Micronecta sp. B-ADU6789 11c285225b8247fa93d6f6914d26b1bc, 8ab7293630c98e69091fe1b78efbca89

Nousia sp. B-ACM3590 bf2227414cea927a76e794da505c1e29

Nousia sp. B-AAV4108 complex fd8e3126f07ab10a767c08e175f8017a

Nousia sp. B-ACM3519 9be6f30d5f0a1e589d9f4567f01215d6

Given that metabarcoding can indtroduce errors in and this may be the cause of these boarderline overlaps. These BIN's will not be combined at this stage
 

```{r}
library(writexl)
library(openxlsx)

# Create a new workbook
wb <- createWorkbook()

# Add worksheets
addWorksheet(wb, "truncated_fills")
addWorksheet(wb, "otu_groups")
addWorksheet(wb, "max_p_update")
addWorksheet(wb, "complexes")

# Write data into each sheet
writeData(wb, sheet = "truncated_fills", truncated_fills_df)
writeData(wb, sheet = "otu_groups", otu_groups_df)
writeData(wb, sheet = "max_p_update", max_p_update_df)
writeData(wb, sheet = "complexes", complexes_df)

# Save the workbook
saveWorkbook(wb, "~/uomShare/wergStaff/MelCarew/git-data/asv_library_97_aug24_modified.xlsx", overwrite = TRUE)
```

